generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String        @id @default(uuid())
  email         String        @unique
  username      String?
  profile       Profile?
  password      String        @unique
  group_members GroupMember[]
  roles         Role[]
  is_active     Boolean       @default(false)
  create_at     DateTime      @default(now())

  @@map("t_users")
}

model Profile {
  id              String    @id @default(uuid())
  last_connection DateTime
  date_of_birth   DateTime?
  photo           String?
  userEmail       String    @unique
  users           User      @relation(fields: [userEmail], references: [email], onDelete: NoAction, onUpdate: NoAction)
  lang            LANGUAGES @default(EN)

  @@map("t_profiles")
}

model Message {
  id              String       @id @default(uuid())
  conversation_id String
  conversaton     Conversation @relation(fields: [conversation_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sent_datetime   DateTime

  @@map("t_messages")
}

model Conversation {
  id            String              @id @default(uuid())
  type          CONVERSATION_TYPE   @default(SINGLE)
  group_members GroupMember[]
  messages      Message[]
  configs       ConversationConfig?
  name          String              @unique

  @@map("t_conversations")
}

model GroupMember {
  group_member_id String            @id @unique @default(uuid())
  user_id         String
  conversation_id String
  user            User              @relation(fields: [user_id], references: [id])
  conversation    Conversation      @relation(fields: [conversation_id], references: [id])
  role            GROUP_MEMBER_ROLE @default(ADMIN)
  join_time       DateTime
  left_time       DateTime?

  @@map("t_group_member")
}

model ConversationConfig {
  id               String       @id @unique @default(uuid())
  description      String
  conversationName String       @unique
  conversation     Conversation @relation(fields: [conversationName], references: [name])

  @@map("t_conversation_config")
}

model Role {
  id          String       @id @unique @default(uuid())
  name        String       @unique
  description String?
  users       User[]
  created_at  DateTime     @default(now())
  updated_at  DateTime?
  permissions Permission[]

  @@map("t_roles")
}

model Permission {
  id          String    @id @unique @default(uuid())
  name        String    @unique
  description String?
  created_at  DateTime  @default(now())
  updated_at  DateTime?
  roles       Role[]

  @@map("t_persmissions")
}

model Otp {
  id        String   @id @unique @default(uuid())
  email     String
  code      Int
  create_at DateTime @default(now())

  @@map("t_otp")
}

enum CONVERSATION_TYPE {
  SINGLE
  MULTIPLE
  SCHEDULED
}

enum GROUP_MEMBER_ROLE {
  ADMIN
  MEMBER
  SUPER_ADMIN
}

enum LANGUAGES {
  FR
  EN
}
